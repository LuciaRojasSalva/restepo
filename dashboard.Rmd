---
title: "Registro Nacional de Denuncias de Delitos y Faltas 2017"
output: 
  flexdashboard::flex_dashboard:
    orientation: columns
    vertical_layout: fill
runtime: shiny
---
  
```{r setup, include=FALSE}
library(flexdashboard)
library(readr)
library(raster)
library(ggplot2)
library(dplyr)
library(lubridate)
library(haven)
library(highcharter)
library(maptools)  
library(RColorBrewer) 
library(readxl)
library(leaflet)
library(broom)
library(dplyr)
library(ggplot2)
library(classInt) 
library(sp)
library(rgdal)
library(spdep) 
library(ggpubr)
library(rgeos)
```


```{r, results='hide'}
#Cargamos la base de datos desde el repositorio
cap100<-read_sav("D:/BD_varias/RENADEF 2017/100.sav")
cap200<-read_sav("D:/BD_varias/RENADEF 2017/200.sav")
cap300<-read_sav("D:/BD_varias/RENADEF 2017/300.sav")

#Realizamos el merge de los tres módulos
#crimen<-merge(cap200,cap300,by = intersect(names(cap200), names(cap300)))
#names(crimen)[4]<-"UBIGEO"
#crimen1<-merge(cap100,crimen,by="UBIGEO")

# Provincias:
peru_prov<- readOGR("D:/GADM/gadm36_PER_2.shp")
# Distritos:
peru_distr <- readOGR("D:/GADM/gadm36_PER_3.shp")

```

Introducción
===================================================================

  
Column {.sidebar data-width=400}
-----------------------------------------------------------------------
  
### Número de denuncias de faltas por provincia

```{r, message = FALSE, echo = FALSE}


pal <- colorFactor(
  palette = "Paired",
  domain = peru_prov@data$NAME_1)

leaflet(peru_prov) %>%
  addTiles() %>%
  addPolygons(weight = 1,
              stroke = TRUE,
              color = "white",
              fillColor = ~pal(NAME_1),
              fillOpacity = 0.7,
              dashArray = "3",
              label = ~NAME_2,
              popup = ~paste("<b>Provincia:</b>", NAME_2,
                             "<br/>",
                             "<b>Departamento:</b>", NAME_1,
                             "<br/>",
                             "<b>Total de faltas:</b>",cap100$FALTAS,
                             "<br/>",
                             "<b>Faltas contra la persona:</b>",cap100$FALTAS_A,
                             "<br/>",
                             "<b>Faltas contra el patrimonio:</b>",cap100$FALTAS_B,
                             "<br/>",
                             "<b>Faltas contra las buenas costumbres:</b>",cap100$FALTAS_C,
                             "<br/>",
                             "<b>Faltas contra la seguridad pública:</b>",cap100$FALTAS_D
                             ),
              highlight = highlightOptions(
                weight = 2,
                dashArray = "",
                color = "grey",
                bringToFront = TRUE
              ))


```

Column {data-width=350}
-----------------------------------------------------------------------
  
### Chart B
  
```{r}
selectizeInput("Departamento", label = "Departamento:",
          choices =unique(cap200[c("NOMBREDD")]),selected = "Amazonas")

selectizeInput("Provincia", label = "Provincia:",
          choices=NULL,options = list(maxOptions = 2000000))
  
 selectizeInput("Distrito", label = "Distrito:",
          choices=NULL,options = list(maxOptions = 2000000))

observeEvent(input$Departamento,
      updateSelectizeInput(session,"Provincia","Provincia",choices=cap200$NOMBREPP[cap200$NOMBREDD==input$Departamento], server = TRUE))

observeEvent(input$Provincia,
      updateSelectizeInput(session,"Distrito","Distrito",choices=cap200$NOMBREDI[cap200$NOMBREPP==input$Provincia & cap200$NOMBREDD==input$Departamento], server = TRUE))

```


Detalles 1 {data-navmenu="Info"}
===================================================================
  
### Chart D
  
```{r}

```


Detalles 2 {data-navmenu="Info"}
===================================================================
  
### Chart E
  
```{r}

```